<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Richard Chandler" />


<title>Modeling variation in abundance using capture-recapture data</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Modeling variation in abundance using capture-recapture data</h1>
<h4 class="author">Richard Chandler</h4>
<h4 class="date">Feb 24, 2019</h4>


<div id="TOC">
<ul>
<li><a href="#abstract"><span class="toc-section-number">1</span> Abstract</a></li>
<li><a href="#introduction"><span class="toc-section-number">2</span> Introduction</a></li>
<li><a href="#data"><span class="toc-section-number">3</span> Data</a></li>
<li><a href="#closed-population-models"><span class="toc-section-number">4</span> Closed Population Models</a>
<ul>
<li><a href="#models-m_0-m_t-and-models-with-covariates-of-p."><span class="toc-section-number">4.1</span> Models <span class="math inline">\(M_0\)</span>, <span class="math inline">\(M_t\)</span>, and models with covariates of <span class="math inline">\(p\)</span>.</a></li>
<li><a href="#modeling-behavioral-responses-model-m_b"><span class="toc-section-number">4.2</span> Modeling behavioral responses, Model <span class="math inline">\(M_b\)</span></a></li>
<li><a href="#caution-warning-danger"><span class="toc-section-number">4.3</span> Caution, Warning, Danger</a></li>
<li><a href="#individual-heterogeneity-in-capture-probability-model-m_h"><span class="toc-section-number">4.4</span> Individual Heterogeneity in Capture Probability, Model <span class="math inline">\(M_h\)</span></a></li>
<li><a href="#distance-related-heterogeneity"><span class="toc-section-number">4.5</span> Distance-related heterogeneity</a></li>
</ul></li>
<li><a href="#modeling-temporary-emigration"><span class="toc-section-number">5</span> Modeling Temporary Emigration</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<div id="abstract" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Abstract</h1>
<p>The “un” in <code>unmarked</code> is somewhat misleading because the package can be used to analyze data from marked animals. The three most common sampling methods that produce suitable data are removal sampling, double observer sampling, and capture-recapture methods. This document focuses on the analysis of capture-recapture data using a class of models known as multinomial <span class="math inline">\(N\)</span>-mixture models <span class="citation">(Royle 2004, Dorazio et al. 2005)</span>, which assume that capture-recapture data have been collected at a collection of sample locations (“sites”). Capture-recapture models can be fitted with constant parameters (<span class="math inline">\(M_0\)</span>), time-specific parameters (<span class="math inline">\(M_t\)</span>), and behavioral responses (<span class="math inline">\(M_b\)</span>). In addition, spatial variation in abundance and capture probability can also be modeled using covariates. <code>unmarked</code> has two functions for fitting capture-recapture models: <code>multinomPois</code> and <code>gmultmix</code>. Both allow for user-defined functions to describe the capture process, and the latter allows for modeling of temporary emigration when data have been collected using the so-called robust design <span class="citation">(Kendall et al. 1997, Chandler et al. 2011)</span>.</p>
</div>
<div id="introduction" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Introduction</h1>
<p>In traditional capture-recapture models, <span class="math inline">\(n\)</span> individuals are captured at a site during the course of <span class="math inline">\(J\)</span> sampling occasions. The encounter history for each individual is used as information about capture probability <span class="math inline">\(p\)</span> such that the total population size <span class="math inline">\(N\)</span> can be regarded as the size parameter of a binomial distribution, <span class="math inline">\(n \sim \mbox{Binomial}(N, p)\)</span>.</p>
<p>Although traditional capture-recapture models are useful for estimating population size when <span class="math inline">\(p&lt;1\)</span>, they do not allow one to model variation in abundance, which is a central focus of much ecological research. <span class="citation">Royle (2004)</span> and <span class="citation">Dorazio et al. (2005)</span> developed a framework for modeling variation in both abundance and capture probability when capture-recapture data are collected at a set of <span class="math inline">\(R\)</span> sites. Site-specific abundance (<span class="math inline">\(N_i; i=1,2,...,R\)</span>) is regarded as latent variable following a discrete distribution such as the Poisson or negative binomial. The encounter histories are then tabulated at each site so that they can be regarded as an outcome of a multinomial distribution with cell probabilities <span class="math inline">\(\bf \pi\)</span> determined by a protocol-specific function of capture probability. Assuming a Poisson distribution, the model can be written as <span class="math display">\[
\begin{gather}
  N_i \sim \mbox{Poisson}(\lambda) \nonumber \\
  {\bf y_i}|N_i \sim \mbox{Multinomial}(N_i, \pi(p))
  \label{mod}
\end{gather}
\]</span> In the above, <span class="math inline">\(\lambda\)</span> is the expected number of individuals at each site. <span class="math inline">\({\bf y_i}\)</span> is a vector containing the number of individuals with encounter history <span class="math inline">\(k; k=1,2,...K\)</span> at site <span class="math inline">\(i\)</span>. The number of observable encounter histories <span class="math inline">\(K\)</span> depends on the sampling protocol. For a capture-recapture study with 2 occasions, there are 3 possible encounter histories <span class="math inline">\(H \in (11, 10, 01)\)</span>. In Equation 1, <span class="math inline">\(\pi(p)\)</span> is a function that that converts capture probability <span class="math inline">\(p\)</span> to multinomial cell probabilities, , the proportion of individuals expected to have capture history <span class="math inline">\(k\)</span>. For example, the cell probabilities corresponding to the capture histories listed above are</p>
<p><span class="math display">\[
{\bf \pi}(p) = \{ p^2, p(1-p), (1-p)p \}.
\]</span></p>
<p>The probability of not capturing an individual in this case (<span class="math inline">\(H=00\)</span>) is <span class="math inline">\((1-p)^2\)</span>.</p>
<p>Spatial variation in abundance can be modeled using covariates with a log-link function <span class="math display">\[
\log(\lambda_i) = \beta_0 + \beta_1 x_i
\]</span> where <span class="math inline">\(x_i\)</span> is some site-specific covariate such as habitat type or elevation. Multiple covariates can be considered and a more general form of the above can be written as <span class="math inline">\(\log(\lambda_i) = {\bf X}_i&#39; \bf \beta\)</span> where <span class="math inline">\({\bf X}\)</span> is a design matrix and <span class="math inline">\({\bf \beta}\)</span> is a vector of coefficients, possibly including an intercept. Capture probability can be modeled using the logit-link in much the same way <span class="math display">\[
\text{logit}(p_{ij}) = \alpha_0 + \alpha_1 v_{ij}
\]</span> where <span class="math inline">\(v_{ij}\)</span> is some covariate specific to the site and capture occasion. When <span class="math inline">\(p\)</span> is assumed to be constant, the model is often referred to as model <span class="math inline">\(M_0\)</span>. Alternatively, <span class="math inline">\(p\)</span> may be occasion-specific (model <span class="math inline">\(M_t\)</span>) or may be influenced by animal behavior (model <span class="math inline">\(M_b\)</span>). <span class="citation">Otis et al. (1978)</span> and <span class="citation">Williams et al. (2002)</span> are comprehensive references.</p>
</div>
<div id="data" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Data</h1>
<p>As previously mentioned, the data required by <code>unmarked</code> are an <span class="math inline">\(R \times K\)</span> matrix in which each row is the vector of tabulated encounter histories for animals captured at some site. Capture-recapture data, however, is typically recorded in the format shown in Table 1.</p>
<table>
<caption>Table 1. Capture-recapture data for 6 individuals sampled on 3 occasions</caption>
<thead>
<tr class="header">
<th align="left">Animal ID</th>
<th align="center">Site</th>
<th align="center">Capture history</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GB</td>
<td align="center">A</td>
<td align="center">101</td>
</tr>
<tr class="even">
<td align="left">YR</td>
<td align="center">A</td>
<td align="center">101</td>
</tr>
<tr class="odd">
<td align="left">RO</td>
<td align="center">A</td>
<td align="center">111</td>
</tr>
<tr class="even">
<td align="left">PP</td>
<td align="center">A</td>
<td align="center">100</td>
</tr>
<tr class="odd">
<td align="left">GY</td>
<td align="center">B</td>
<td align="center">100</td>
</tr>
<tr class="even">
<td align="left">PR</td>
<td align="center">B</td>
<td align="center">010</td>
</tr>
</tbody>
</table>
<p>In the absence of individual covariates, the data in Table 1 can be converted to the requisite format as shown in Table 2. Notice that no captures were made in sites C and D. It is important that such sites are retained in the analysis in order to make inference about spatial variation in abundance.</p>
<table>
<caption>Table 2. Capture-recapture data from Table 1 in the format required by unmarked</caption>
<thead>
<tr class="header">
<th align="left">Site</th>
<th align="center">100</th>
<th align="center">010</th>
<th align="center">001</th>
<th align="center">110</th>
<th align="center">011</th>
<th align="center">101</th>
<th align="center">111</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">C</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">D</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
</div>
<div id="closed-population-models" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Closed Population Models</h1>
<div id="models-m_0-m_t-and-models-with-covariates-of-p." class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> Models <span class="math inline">\(M_0\)</span>, <span class="math inline">\(M_t\)</span>, and models with covariates of <span class="math inline">\(p\)</span>.</h2>
<p>In this example we will analyze point count data collected on alder flycatchers (<em>Empidonax alnorum</em>) by <span class="citation">Chandler et al. (2009)</span>. Point count data such as these are collected on unmarked animals, but one can apply capture-recapture models because it is possible to keep track of individual birds during a short period of time <span class="citation">(Alldredge et al. 2007)</span>. That is, we can pretend like birds are marked by noting which time intervals they are detected in during a short survey. The alder flycatcher data were collected using fixed-area 15-minute point counts, which were divided into 3 5-minute intervals. Each point was surveyed 3 times during 2005. The following command imports the capture histories for 50 individuals detected in 2005 at 49 point count locations.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>alfl &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">system.file</span>(<span class="st">&quot;csv&quot;</span>, <span class="st">&quot;alfl.csv&quot;</span>, <span class="dt">package=</span><span class="st">&quot;unmarked&quot;</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">head</span>(alfl, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##          id survey interval1 interval2 interval3
## 1 crick1_05      1         1         1         1
## 2 crick1_05      3         1         0         1
## 3   his1_05      1         0         1         1
## 4   his1_05      1         1         1         1
## 5   his1_05      2         0         1         1</code></pre>
<p>We see 5 rows of data representing the encounter histories for 5 birds detected at 2 points during 3 survey occasions. From these 5 birds, it appears as though detection probability is high since each bird was detected during at least 2 of the three time intervals.</p>
<p>Associated with the bird data are site- and visit-specific covariates for each of the 49 sites. We can import these data using the following command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>alfl.covs &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">system.file</span>(<span class="st">&quot;csv&quot;</span>, <span class="st">&quot;alflCovs.csv&quot;</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>    <span class="dt">package=</span><span class="st">&quot;unmarked&quot;</span>), <span class="dt">row.names=</span><span class="dv">1</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="kw">head</span>(alfl.covs)</span></code></pre></div>
<pre><code>##           struct woody time.1 time.2 time.3 date.1 date.2 date.3
## crick1_05   5.45  0.30   8.68   8.73   5.72      6     25     34
## his1_05     4.75  0.05   9.43   7.40   7.58     20     32     54
## hisw1_05   14.70  0.35   8.25   6.70   7.62     20     32     47
## hisw2_05    5.05  0.30   7.77   6.23   7.17     20     32     47
## kenc1_05    4.15  0.10   9.57   9.55   5.73      8     27     36
## kenc2_05    9.75  0.40   9.10   9.12   9.12      8     27     36</code></pre>
<p>Each row of this <code>data.frame</code> corresponds to a point count location. The variable <code>struct</code> is a measure of vegetation structure, and <code>woody</code> is the percent cover of woody vegetation at each of the 50-m radius plots. Time of day and date were measured for each of the three visits.</p>
<p>To format the data for <code>unmarked</code>, we need to tabulate the encounter histories for each site. Before doing so, let’s first put our capture histories in a single column. Let’s also be explicit about the levels of our factors for both the newly created <code>captureHistory</code> column and the point id column.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>alfl<span class="op">$</span>captureHistory &lt;-<span class="st"> </span><span class="kw">paste</span>(alfl<span class="op">$</span>interval1, alfl<span class="op">$</span>interval2, alfl<span class="op">$</span>interval3, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>alfl<span class="op">$</span>captureHistory &lt;-<span class="st"> </span><span class="kw">factor</span>(alfl<span class="op">$</span>captureHistory,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;001&quot;</span>, <span class="st">&quot;010&quot;</span>, <span class="st">&quot;011&quot;</span>, <span class="st">&quot;100&quot;</span>, <span class="st">&quot;101&quot;</span>, <span class="st">&quot;110&quot;</span>, <span class="st">&quot;111&quot;</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="co">## Don&#39;t do this:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="co">#levels(alfl$id) &lt;- rownames(alfl.covs)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>alfl<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">factor</span>(alfl<span class="op">$</span>id, <span class="dt">levels=</span><span class="kw">rownames</span>(alfl.covs))</span></code></pre></div>
<p>Specifying the levels of <code>captureHistory</code> ensures that when we tabulate the encounter histories, we will include zeros for histories that were not observed. Similarly, setting the levels of <code>alfl$id</code> tells <code>R</code> that there were some sites where no ALFL were detected. This way, when we tabulate the data, we get a frequency for each site, not just the ones with &gt;1 detection. Here are the commands to extract data from the first primary period and to tabulate the encounter histories.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>alfl.v1 &lt;-<span class="st"> </span>alfl[alfl<span class="op">$</span>survey<span class="op">==</span><span class="dv">1</span>,]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>alfl.H1 &lt;-<span class="st"> </span><span class="kw">table</span>(alfl.v1<span class="op">$</span>id, alfl.v1<span class="op">$</span>captureHistory)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="kw">head</span>(alfl.H1, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##            
##             001 010 011 100 101 110 111
##   crick1_05   0   0   0   0   0   0   1
##   his1_05     0   0   1   0   0   0   1
##   hisw1_05    0   0   0   0   0   0   0
##   hisw2_05    0   0   0   0   0   0   1
##   kenc1_05    0   0   0   0   0   0   0</code></pre>
<p>The object <code>alfl.H1</code> contains the tabulated capture histories for each site. This is the format required by <code>unmarked</code>. The data from the first 5 sites suggest that detection probability was high since the most common encounter history was <code>111</code>.</p>
<p>Now we are almost ready to create our <code>unmarkedFrame</code> and begin fitting models. We will fit our first series of models using the <code>multinomPois</code> function, which requires data formated using the <code>unmarkedFrameMPois</code> function. This constructor function has an argument , which currently can be set to <code>&quot;removal&quot;</code> or <code>&quot;double&quot;</code>, corresponding to removal sampling data and double observer sampling respectively. In doing so, the function automatically creates the function to convert <span class="math inline">\(p\)</span> to <span class="math inline">\({\bf \pi}\)</span>. If <code>type</code> is missing, however, the user needs to specify a function to convert detection probability to multinomial cell probabilities. In the future, we may add an  option to automatically handle standard capture-recapture data too, but here we show how to supply it using a user-defined <code>piFun</code>, which allows flexibility in converting detection probability to multinomial cell probabilities <span class="math inline">\(\bf \pi\)</span>. The <code>piFun</code> must take a matrix of detection probabilities with <span class="math inline">\(J\)</span> columns (3 in this case), and convert them to a matrix of multinomial cell probabilities with <span class="math inline">\(K\)</span> columns. Each column corresponds to the probability of observing the encounter history <span class="math inline">\(k\)</span>. Here is a <code>piFun</code> to compute the multinomial cell probabilities when there were 3 sampling occasions. This function allows us to fit models <span class="math inline">\(M_0\)</span>, <span class="math inline">\(M_t\)</span>, or models with covariates of <span class="math inline">\(p\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>crPiFun &lt;-<span class="st"> </span><span class="cf">function</span>(p) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    p1 &lt;-<span class="st"> </span>p[,<span class="dv">1</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>    p2 &lt;-<span class="st"> </span>p[,<span class="dv">2</span>]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>    p3 &lt;-<span class="st"> </span>p[,<span class="dv">3</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    <span class="kw">cbind</span>(<span class="st">&quot;001&quot;</span> =<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p1) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p2) <span class="op">*</span><span class="st"> </span>p3,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>          <span class="st">&quot;010&quot;</span> =<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p1) <span class="op">*</span><span class="st"> </span>p2     <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p3),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>          <span class="st">&quot;011&quot;</span> =<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p1) <span class="op">*</span><span class="st"> </span>p2     <span class="op">*</span><span class="st"> </span>p3,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>          <span class="st">&quot;100&quot;</span> =<span class="st"> </span>p1     <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p2) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p3),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>          <span class="st">&quot;101&quot;</span> =<span class="st"> </span>p1     <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p2) <span class="op">*</span><span class="st"> </span>p3,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>          <span class="st">&quot;110&quot;</span> =<span class="st"> </span>p1     <span class="op">*</span><span class="st"> </span>p2     <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p3),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>          <span class="st">&quot;111&quot;</span> =<span class="st"> </span>p1     <span class="op">*</span><span class="st"> </span>p2     <span class="op">*</span><span class="st"> </span>p3)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>}</span></code></pre></div>
<p>To demonstrate how this works, imagine that we surveyed 2 sites and detection probability was constant (<span class="math inline">\(p=0.2\)</span>) among sites and survey occasions. The function converts these capture probabilities to multinomial cell probabilities. Note that these cell probabilities will sum to &lt;1 if capture probability is less than 1 over the 3 occasions.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="fl">0.4</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="kw">crPiFun</span>(p)</span></code></pre></div>
<pre><code>##        001   010   011   100   101   110   111
## [1,] 0.144 0.144 0.096 0.144 0.096 0.096 0.064
## [2,] 0.144 0.144 0.096 0.144 0.096 0.096 0.064</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">rowSums</span>(<span class="kw">crPiFun</span>(p))</span></code></pre></div>
<pre><code>## [1] 0.784 0.784</code></pre>
<p>When providing a user-defined , we also need to provide information about how to handle missing values. That is, if we have a missing value in a covariate, we need to know which values of <span class="math inline">\({\bf y}\)</span> are affected. In <code>unmarked</code>, this can be done by supplying a mapping-matrix to the <code>obsToY</code> argument in the <code>unmarkedFrameMPois</code> function. <code>obsToY</code> needs to be a matrix of zeros and ones with the number of rows equal to the number of columns for some obsCov, and the number columns equal to the number of columns in <span class="math inline">\({\bf y}\)</span>. If <code>obsToY[j,k]</code>=1, then a missing value in <code>obsCov[i,j]</code> translates to a missing value in <code>y[i,k]</code>. For the capture-recapture data considered here, we can set all elements of <code>obsToY</code> to 1.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>o2y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">7</span>)</span></code></pre></div>
<p>We are now ready to create the <code>unmarkedFrame</code>. In order to fit model <span class="math inline">\(M_t\)</span>, we need a covariate that references the time interval , which we call <code>intervalMat</code> below. We also provide a couple of site-specific covariates: the percent cover of woody vegetation and vegetation structure.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">library</span>(unmarked)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>intervalMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="st">&#39;1&#39;</span>,<span class="st">&#39;2&#39;</span>,<span class="st">&#39;3&#39;</span>), <span class="dv">50</span>, <span class="dv">3</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a><span class="kw">class</span>(alfl.H1) &lt;-<span class="st"> &quot;matrix&quot;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>umf.cr1 &lt;-<span class="st"> </span><span class="kw">unmarkedFrameMPois</span>(<span class="dt">y=</span>alfl.H1,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>    <span class="dt">siteCovs=</span>alfl.covs[,<span class="kw">c</span>(<span class="st">&quot;woody&quot;</span>, <span class="st">&quot;struct&quot;</span>, <span class="st">&quot;time.1&quot;</span>, <span class="st">&quot;date.1&quot;</span>)],</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>    <span class="dt">obsCovs=</span><span class="kw">list</span>(<span class="dt">interval=</span>intervalMat),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>    <span class="dt">obsToY=</span>o2y, <span class="dt">piFun=</span><span class="st">&quot;crPiFun&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: obsCovs contains characters. Converting them to factors.</code></pre>
<p>Writing a <code>piFun</code> and creating the <code>obsToY</code> object are the hardest parts of a capture-recapture analysis in <code>unmarked</code>. Again, this is done automatically for removal models and double observer models, and we may add an option to do this automatically for capture-recapture data too, but hopefully the flexibility allowed by specifying user-defined functions is evident.</p>
<p>Now that we have our data formatted we can fit some models. The following correspond to model <span class="math inline">\(M_0\)</span>, model <span class="math inline">\(M_t\)</span>, and a model with a continuous covariate effect on <span class="math inline">\(p\)</span>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>M0 &lt;-<span class="st"> </span><span class="kw">multinomPois</span>(<span class="op">~</span><span class="dv">1</span> <span class="op">~</span><span class="dv">1</span>, umf.cr1, <span class="dt">engine=</span><span class="st">&quot;R&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a>Mt &lt;-<span class="st"> </span><span class="kw">multinomPois</span>(<span class="op">~</span>interval<span class="dv">-1</span> <span class="op">~</span><span class="dv">1</span>, umf.cr1, <span class="dt">engine=</span><span class="st">&quot;R&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>Mx &lt;-<span class="st"> </span><span class="kw">multinomPois</span>(<span class="op">~</span>time<span class="fl">.1</span> <span class="op">~</span><span class="dv">1</span>, umf.cr1, <span class="dt">engine=</span><span class="st">&quot;R&quot;</span>)</span></code></pre></div>
<p>The first two models can be fit in other software programs. What is unique about <code>unmarked</code> is that we can also model variation in abundance and detection probability among sites. The following model treats abundance as a function of the percent cover of woody vegetation.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>(M0.woody &lt;-<span class="st"> </span><span class="kw">multinomPois</span>(<span class="op">~</span><span class="dv">1</span> <span class="op">~</span>woody, umf.cr1, <span class="dt">engine=</span><span class="st">&quot;R&quot;</span>))</span></code></pre></div>
<pre><code>## 
## Call:
## multinomPois(formula = ~1 ~ woody, data = umf.cr1, engine = &quot;R&quot;)
## 
## Abundance:
##             Estimate    SE     z  P(&gt;|z|)
## (Intercept)   -0.962 0.325 -2.96 0.003059
## woody          2.587 0.680  3.80 0.000143
## 
## Detection:
##  Estimate    SE    z  P(&gt;|z|)
##      1.43 0.216 6.63 3.42e-11
## 
## AIC: 245.9301</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>nd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">woody=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="dt">length=</span><span class="dv">50</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>E.abundance &lt;-<span class="st"> </span><span class="kw">predict</span>(M0.woody, <span class="dt">type=</span><span class="st">&quot;state&quot;</span>, <span class="dt">newdata=</span>nd, <span class="dt">appendData=</span><span class="ot">TRUE</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a><span class="kw">plot</span>(Predicted <span class="op">~</span><span class="st"> </span>woody, E.abundance, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a>     <span class="dt">ylab=</span><span class="st">&quot;Alder flycatchers / plot&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Woody vegetation cover&quot;</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a><span class="kw">lines</span>(lower <span class="op">~</span><span class="st"> </span>woody, E.abundance, <span class="dt">col=</span><span class="kw">gray</span>(<span class="fl">0.7</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a><span class="kw">lines</span>(upper <span class="op">~</span><span class="st"> </span>woody, E.abundance, <span class="dt">col=</span><span class="kw">gray</span>(<span class="fl">0.7</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>What about detection probability? Since there was no evidence of variation in <span class="math inline">\(p\)</span>, we can simply back-transform the logit-scale estimate to obtain <span class="math inline">\(\hat{p}\)</span>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="kw">backTransform</span>(M0.woody, <span class="dt">type=</span><span class="st">&quot;det&quot;</span>)</span></code></pre></div>
<pre><code>## Backtransformed linear combination(s) of Detection estimate(s)
## 
##  Estimate     SE LinComb (Intercept)
##     0.808 0.0336    1.43           1
## 
## Transformation: logistic</code></pre>
<p>As suggested by the raw data, detection probability was very high. The corresponding multinomial cell probabilities can be computed by plugging this estimate of detection probability into our <code>piFun</code>. This <code>getP</code> function makes this easy.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="kw">round</span>(<span class="kw">getP</span>(M0.woody), <span class="dv">2</span>)[<span class="dv">1</span>,]</span></code></pre></div>
<pre><code>##  001  010  011  100  101  110  111 
## 0.03 0.03 0.13 0.03 0.13 0.13 0.53</code></pre>
<p>Note that the encounter probability most likely to be observed was 111. In fact <span class="math inline">\(p\)</span> was so high that the probability of not detecting an alder flycatcher was essentially zero, <span class="math inline">\((1-0.81)^3 = 0.007\)</span>.</p>
</div>
<div id="modeling-behavioral-responses-model-m_b" class="section level2" number="4.2">
<h2 number="4.2"><span class="header-section-number">4.2</span> Modeling behavioral responses, Model <span class="math inline">\(M_b\)</span></h2>
<p>An animal’s behavior might change after being captured. Both trap avoidance and trap attraction are frequently observed in a variety of taxa. A simple model of these two behaviors is known as model <span class="math inline">\(M_b\)</span> <span class="citation">(Otis et al. 1978)</span>. The model assumes that newly-captured individuals are captured with probability <span class="math inline">\(p_{naive}\)</span> and then are subsequently recaptured with probability <span class="math inline">\(p_{wise}\)</span>. If <span class="math inline">\(p_{wise} &lt; p_{naive}\)</span>, then animals exhibit trap avoidance. In some cases, such as when traps are baited, we might observed <span class="math inline">\(p_{wise} &gt; p_{naive}\)</span> in which case the animals are said to be “trap-happy”.</p>
<p>To fit model <span class="math inline">\(M_b\)</span> in <code>unmarked</code>, we need to create a new <code>piFun</code> and we need to provide an occasion-specific covariate (<code>obsCov</code>) that distinguishes the two capture probabilities, <span class="math inline">\(p_{naive}\)</span> and <span class="math inline">\(p_{wise}\)</span>. The simplest possible approach is the following</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a>crPiFun.Mb &lt;-<span class="st"> </span><span class="cf">function</span>(p) { <span class="co"># p should have 3 columns</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>    pNaive &lt;-<span class="st"> </span>p[,<span class="dv">1</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a>    pWise &lt;-<span class="st"> </span>p[,<span class="dv">3</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>    <span class="kw">cbind</span>(<span class="st">&quot;001&quot;</span> =<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pNaive) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pNaive) <span class="op">*</span><span class="st"> </span>pNaive,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a>          <span class="st">&quot;010&quot;</span> =<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pNaive) <span class="op">*</span><span class="st"> </span>pNaive     <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pWise),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a>          <span class="st">&quot;011&quot;</span> =<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pNaive) <span class="op">*</span><span class="st"> </span>pNaive     <span class="op">*</span><span class="st"> </span>pWise,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>          <span class="st">&quot;100&quot;</span> =<span class="st"> </span>pNaive     <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pWise)  <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pWise),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a>          <span class="st">&quot;101&quot;</span> =<span class="st"> </span>pNaive     <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pWise)  <span class="op">*</span><span class="st"> </span>pWise,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a>          <span class="st">&quot;110&quot;</span> =<span class="st"> </span>pNaive     <span class="op">*</span><span class="st"> </span>pWise      <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>pWise),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a>          <span class="st">&quot;111&quot;</span> =<span class="st"> </span>pNaive     <span class="op">*</span><span class="st"> </span>pWise      <span class="op">*</span><span class="st"> </span>pWise)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a>}</span></code></pre></div>
<p>This function <code>crPiFun.Mb</code> allows capture probability to be modeled as <span class="math display">\[
\text{logit}(p_{ij}) = \alpha_{naive} + \alpha_{wise} behavior_j + \alpha_1 x_i
\]</span> where <span class="math inline">\(behavior_j\)</span> is simply a dummy variable. Thus, when no site-specific covariates (<span class="math inline">\(x_i\)</span>) are included, <span class="math inline">\(p_{ij}\)</span> is either <span class="math inline">\(p_{naive}\)</span> or <span class="math inline">\(p_{wise}\)</span>. The following code constructs a new <code>unmarkedFrame</code> and fits model <span class="math inline">\(M_b\)</span> to the alder flycatcher data.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a>behavior &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="st">&#39;Naive&#39;</span>,<span class="st">&#39;Naive&#39;</span>,<span class="st">&#39;Wise&#39;</span>), <span class="dv">50</span>, <span class="dv">3</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a>umf.cr1Mb &lt;-<span class="st"> </span><span class="kw">unmarkedFrameMPois</span>(<span class="dt">y=</span>alfl.H1,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a>    <span class="dt">siteCovs=</span>alfl.covs[,<span class="kw">c</span>(<span class="st">&quot;woody&quot;</span>, <span class="st">&quot;struct&quot;</span>, <span class="st">&quot;time.1&quot;</span>)],</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a>    <span class="dt">obsCovs=</span><span class="kw">list</span>(<span class="dt">behavior=</span>behavior),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a>    <span class="dt">obsToY=</span>o2y, <span class="dt">piFun=</span><span class="st">&quot;crPiFun.Mb&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: obsCovs contains characters. Converting them to factors.</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a>M0 &lt;-<span class="st"> </span><span class="kw">multinomPois</span>(<span class="op">~</span><span class="dv">1</span> <span class="op">~</span><span class="dv">1</span>, umf.cr1Mb, <span class="dt">engine=</span><span class="st">&quot;R&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>(Mb &lt;-<span class="st"> </span><span class="kw">multinomPois</span>(<span class="op">~</span>behavior<span class="dv">-1</span> <span class="op">~</span><span class="dv">1</span>, umf.cr1Mb, <span class="dt">engine=</span><span class="st">&quot;R&quot;</span>))</span></code></pre></div>
<pre><code>## 
## Call:
## multinomPois(formula = ~behavior - 1 ~ 1, data = umf.cr1Mb, engine = &quot;R&quot;)
## 
## Abundance:
##  Estimate    SE      z P(&gt;|z|)
##   0.00955 0.142 0.0674   0.946
## 
## Detection:
##               Estimate    SE    z  P(&gt;|z|)
## behaviorNaive     1.31 0.356 3.69 2.25e-04
## behaviorWise      1.50 0.276 5.44 5.27e-08
## 
## AIC: 260.0599</code></pre>
<p>AIC gives us no reason to favor model <span class="math inline">\(M_b\)</span> over model <span class="math inline">\(M_0\)</span>. This is perhaps not too surprising given that the alder flycatchers were not actually captured. Here is a command to compute 95% confidence intervals for the two detection probabilities.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a><span class="kw">plogis</span>(<span class="kw">confint</span>(Mb, <span class="dt">type=</span><span class="st">&quot;det&quot;</span>, <span class="dt">method=</span><span class="st">&quot;profile&quot;</span>))</span></code></pre></div>
<pre><code>## Profiling parameter 1 of 2 ... done.
## Profiling parameter 2 of 2 ... done.</code></pre>
<pre><code>##                      0.025     0.975
## p(behaviorNaive) 0.6490219 0.8846530
## p(behaviorWise)  0.7290778 0.8890318</code></pre>
</div>
<div id="caution-warning-danger" class="section level2" number="4.3">
<h2 number="4.3"><span class="header-section-number">4.3</span> Caution, Warning, Danger</h2>
<p>The function <code>crPiFun.Mb</code> is not generic and could easily be abused. For example, you would get bogus results if you tried to use this function to fit model <span class="math inline">\(M_{bt}\)</span>, or if you incorrectly formatted the <code>behavior</code> covariate. Thus, extreme caution is advised when writing user-defined <code>piFun</code>s.</p>
<p>There are also a few limitations regarding user-defined <code>piFun</code>s. First, they can only take a single argument <code>p</code>, which must be the <span class="math inline">\(R \times J\)</span> matrix of detection probabilities. This makes it cumbersome to fit models such as model <span class="math inline">\(M_h\)</span> as described below. It also makes it impossible to fit models such as model <span class="math inline">\(M_{bt}\)</span>. It would be better if <code>piFun</code>s could accept multiple arguments, but this would require some modifications to <code>multinomPois</code> and <code>gmultmix</code>, which we may do in the future.</p>
</div>
<div id="individual-heterogeneity-in-capture-probability-model-m_h" class="section level2" number="4.4">
<h2 number="4.4"><span class="header-section-number">4.4</span> Individual Heterogeneity in Capture Probability, Model <span class="math inline">\(M_h\)</span></h2>
<p>The capture-recapture models covered thus far assume that variation in capture probability can be explained by site-specific covariates, time, or behavior. Currently, <code>unmarked</code> can not fit so-called individual covariate models, in which heterogeneity in <span class="math inline">\(p\)</span> is attributable to animal-specific covariates. However, one could partition the data into strata and analyze the strata separately. For example, sex-specific differences could be studied by dividing the data on males and females into 2 subsets.</p>
<p>Although individual covariate models cannot be considered, it is possible to fit model <span class="math inline">\(M_h\)</span>, which assumes random variation in capture probability among individuals. Here is a <code>piFun</code>, based on code by Andy Royle. It assumes a logit-normal distribution for the random effects <span class="math display">\[
\mbox{logit}(p_i) \sim Normal(\mu, \sigma^2).
\]</span> These random effects are integrated out of the likelihood to obtain the marginal probability of capture.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>MhPiFun &lt;-<span class="st"> </span><span class="cf">function</span>(p) {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a>mu &lt;-<span class="st"> </span><span class="kw">qlogis</span>(p[,<span class="dv">1</span>]) <span class="co"># logit(p)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a>sig &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">qlogis</span>(p[<span class="dv">1</span>,<span class="dv">2</span>]))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true"></a>J &lt;-<span class="st"> </span><span class="kw">ncol</span>(p)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true"></a>M &lt;-<span class="st"> </span><span class="kw">nrow</span>(p)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true"></a>il &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow=</span>M, <span class="dt">ncol=</span><span class="dv">7</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true"></a><span class="kw">dimnames</span>(il) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>, <span class="kw">c</span>(<span class="st">&quot;001&quot;</span>,<span class="st">&quot;010&quot;</span>,<span class="st">&quot;011&quot;</span>,<span class="st">&quot;100&quot;</span>,<span class="st">&quot;101&quot;</span>,<span class="st">&quot;110&quot;</span>,<span class="st">&quot;111&quot;</span>))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>M) {</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true"></a>  il[i,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">integrate</span>( <span class="cf">function</span>(x) {</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true"></a>    (<span class="dv">1</span><span class="op">-</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x))<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x))<span class="op">*</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span><span class="kw">dnorm</span>(x,<span class="dv">0</span>,sig)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true"></a>  }, <span class="dt">lower=</span><span class="op">-</span><span class="ot">Inf</span>, <span class="dt">upper=</span><span class="ot">Inf</span>, <span class="dt">stop.on.error=</span><span class="ot">FALSE</span>)<span class="op">$</span>value</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true"></a>  il[i,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">integrate</span>( <span class="cf">function</span>(x) {</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true"></a>    (<span class="dv">1</span><span class="op">-</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x))<span class="op">*</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x))<span class="op">*</span><span class="kw">dnorm</span>(x,<span class="dv">0</span>,sig)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true"></a>  }, <span class="dt">lower=</span><span class="op">-</span><span class="ot">Inf</span>, <span class="dt">upper=</span><span class="ot">Inf</span>, <span class="dt">stop.on.error=</span><span class="ot">FALSE</span>)<span class="op">$</span>value</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true"></a>  il[i,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">integrate</span>( <span class="cf">function</span>(x) {</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true"></a>    (<span class="dv">1</span><span class="op">-</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x))<span class="op">*</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span><span class="kw">dnorm</span>(x,<span class="dv">0</span>,sig)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true"></a>  }, <span class="dt">lower=</span><span class="op">-</span><span class="ot">Inf</span>, <span class="dt">upper=</span><span class="ot">Inf</span>, <span class="dt">stop.on.error=</span><span class="ot">FALSE</span>)<span class="op">$</span>value</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true"></a>  il[i,<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw">integrate</span>( <span class="cf">function</span>(x) {</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true"></a>    <span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x))<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x))<span class="op">*</span><span class="kw">dnorm</span>(x,<span class="dv">0</span>,sig)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true"></a>  }, <span class="dt">lower=</span><span class="op">-</span><span class="ot">Inf</span>, <span class="dt">upper=</span><span class="ot">Inf</span>, <span class="dt">stop.on.error=</span><span class="ot">FALSE</span>)<span class="op">$</span>value</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true"></a>  il[i,<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="kw">integrate</span>( <span class="cf">function</span>(x) {</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true"></a>    <span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x))<span class="op">*</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span><span class="kw">dnorm</span>(x,<span class="dv">0</span>,sig)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true"></a>  }, <span class="dt">lower=</span><span class="op">-</span><span class="ot">Inf</span>, <span class="dt">upper=</span><span class="ot">Inf</span>, <span class="dt">stop.on.error=</span><span class="ot">FALSE</span>)<span class="op">$</span>value</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true"></a>  il[i,<span class="dv">6</span>] &lt;-<span class="st"> </span><span class="kw">integrate</span>( <span class="cf">function</span>(x) {</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true"></a>    <span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x))<span class="op">*</span><span class="kw">dnorm</span>(x,<span class="dv">0</span>,sig)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true"></a>  }, <span class="dt">lower=</span><span class="op">-</span><span class="ot">Inf</span>, <span class="dt">upper=</span><span class="ot">Inf</span>, <span class="dt">stop.on.error=</span><span class="ot">FALSE</span>)<span class="op">$</span>value</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true"></a>  il[i,<span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">integrate</span>( <span class="cf">function</span>(x) {</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true"></a>    <span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span><span class="kw">plogis</span>(mu[i]<span class="op">+</span>x)<span class="op">*</span><span class="kw">dnorm</span>(x,<span class="dv">0</span>,sig)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true"></a>  }, <span class="dt">lower=</span><span class="op">-</span><span class="ot">Inf</span>, <span class="dt">upper=</span><span class="ot">Inf</span>, <span class="dt">stop.on.error=</span><span class="ot">FALSE</span>)<span class="op">$</span>value</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true"></a>}</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true"></a><span class="kw">return</span>(il)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true"></a>}</span></code></pre></div>
<p>This function does not allow for temporal variation in capture probability because we are using the second column of <code>p</code> as <span class="math inline">\(\sigma\)</span>, the parameter governing the variance of the random effects. Once again, this is somewhat clumsy and it would be better to allow <code>piFun</code> to accept additional arguments, which could be controlled from <code>multinomPois</code> using an additional <code>formula</code>. Such features may be added eventually.</p>
<p>Having defined our new <code>piFun</code>, we can fit the model as follows</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a>parID &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="st">&#39;p&#39;</span>,<span class="st">&#39;sig&#39;</span>,<span class="st">&#39;sig&#39;</span>), <span class="dv">50</span>, <span class="dv">3</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a>umf.cr2 &lt;-<span class="st"> </span><span class="kw">unmarkedFrameMPois</span>(<span class="dt">y=</span>alfl.H1,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a>  <span class="dt">siteCovs=</span>alfl.covs[,<span class="kw">c</span>(<span class="st">&quot;woody&quot;</span>, <span class="st">&quot;struct&quot;</span>, <span class="st">&quot;time.1&quot;</span>)],</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a>  <span class="dt">obsCovs=</span><span class="kw">list</span>(<span class="dt">parID=</span>parID),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true"></a>  <span class="dt">obsToY=</span>o2y, <span class="dt">piFun=</span><span class="st">&quot;MhPiFun&quot;</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true"></a><span class="kw">multinomPois</span>(<span class="op">~</span>parID<span class="dv">-1</span> <span class="op">~</span>woody, umf.cr2)</span></code></pre></div>
<pre><code>## Call:
## multinomPois(formula = ~parID - 1 ~ woody, data = umf.cr2)
##
## Abundance:
##             Estimate    SE     z P(&gt;|z|)
## (Intercept)    -0.84 0.363 -2.31 0.02078
## woody           2.59 0.680  3.81 0.00014
##
## Detection:
##          Estimate    SE    z P(&gt;|z|)
## parIDp      1.637 0.645 2.54  0.0112
## parIDsig    0.841 0.622 1.35  0.1762
## 
## AIC: 242.3731</code></pre>
<p>The estimate of <span class="math inline">\(\sigma\)</span> is high, indicating the existence of substantial heterogeneity in detection probability. However, one should be aware of the concerns about <span class="math inline">\(M_h\)</span> raised by <span class="citation">Link (2003)</span> who demonstrated that population size <span class="math inline">\(N\)</span> is not an identifiable parameter among various classes of models assumed for the random effects. For example, we might use a beta distribution rather than a logit-normal distribution, and obtain very different estimates of abundance. <span class="citation">Link (2003)</span> demonstrated that conventional methods such as AIC cannot be used to discriminate among these models.</p>
</div>
<div id="distance-related-heterogeneity" class="section level2" number="4.5">
<h2 number="4.5"><span class="header-section-number">4.5</span> Distance-related heterogeneity</h2>
<p>Another source of individual heterogeneity in capture probability arises from the distance between animal activity centers and sample locations. Traditional capture-recapture models ignore this important source of variation in capture probability, but recently developed spatial capture-recapture (SCR) models overcome this limitation <span class="citation">(Efford 2004, Royle and Dorazio 2008, Royle and Young 2008)</span>. Distance-related heterogeneity in detection probability was probably not an important concern in the alder flycatcher dataset because the plots were very small (0.785 ha) and only singing birds were included in the analysis. If it were a concern, we could of course collect distance data and use the <code>gdistsamp</code> function to fit a distance sampling model. In other contexts, such as when using arrays of live traps, distance sampling is not an option and SCR models offer numerous advantages over traditional capture-recapture models.</p>
</div>
</div>
<div id="modeling-temporary-emigration" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Modeling Temporary Emigration</h1>
<p>In the previous analysis we used data from the first visit only. <span class="citation">Chandler et al. (2011)</span> proposed a model that allows us to make use of the entire alder flycatcher dataset. The model is similar to the temporary emigration model of <span class="citation">Kendall et al. (1997)</span> except that we are interested in modeling variation in abundance among sites.</p>
<p>The model assumes that no births or deaths occur during the study period, but animals may move on and off the plots between sampling occasions. This type of movement is referred to as temporary emigration. To account for it, define <span class="math inline">\(M_i\)</span> to be the super-population size, the total number of individuals that use site <span class="math inline">\(i\)</span> during the study period. Assume that we visit each site on <span class="math inline">\(T\)</span> primary periods and define <span class="math inline">\(N_{it}\)</span> to be the subset of <span class="math inline">\(M_i\)</span> exposed to sampling during primary period <span class="math inline">\(t\)</span>. We now collect capture-recapture data at each site during each primary period, and obtain the data <span class="math inline">\(\bf y_{it}\)</span>. The model can be written as <span class="math display">\[
\begin{gather}
  M_i \sim \mbox{Poisson}(\lambda) \nonumber \\
  N_{it}|M_i \sim \mbox{Binomial}(M_i, \phi) \nonumber \\
  {\bf y_{it}}|N_{it} \sim \mbox{Multinomial}(N_{it}, \pi(p))
  \label{mod:te}
\end{gather}
\]</span> where <span class="math inline">\(\phi\)</span> is the probability of being available for capture. This can be modeled as a function of covariates using the logit-link.</p>
<p>The data structure for the robust design is more complex than before, but it is easy to create in <code>R</code>. We can once again use the <code>table</code> function - but this time, we create a three-dimensional table rather than a two-dimensional one. We also need to expand the <code>obsToY</code> mapping matrix so that it has a block diagonal structure. This isn’t so intuitive, but the commands below are generic and can be applied to other capture-recapture designs.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a>alfl.H &lt;-<span class="st"> </span><span class="kw">table</span>(alfl<span class="op">$</span>id, alfl<span class="op">$</span>captureHistory, alfl<span class="op">$</span>survey)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a>alfl.Hmat &lt;-<span class="st"> </span><span class="kw">cbind</span>(alfl.H[,,<span class="dv">1</span>], alfl.H[,,<span class="dv">2</span>], alfl.H[,,<span class="dv">3</span>])</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a>nVisits &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true"></a>o2yGMM &lt;-<span class="st"> </span><span class="kw">kronecker</span>(<span class="kw">diag</span>(nVisits), o2y)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true"></a>umf.cr &lt;-<span class="st"> </span><span class="kw">unmarkedFrameGMM</span>(<span class="dt">y=</span>alfl.Hmat,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true"></a>    <span class="dt">siteCovs=</span>alfl.covs[,<span class="kw">c</span>(<span class="st">&quot;woody&quot;</span>, <span class="st">&quot;struct&quot;</span>)],</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true"></a>    <span class="dt">yearlySiteCovs=</span><span class="kw">list</span>(<span class="dt">date=</span>alfl.covs[,<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>], <span class="dt">time=</span>alfl.covs[,<span class="dv">6</span><span class="op">:</span><span class="dv">8</span>]),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true"></a>    <span class="dt">obsCovs=</span><span class="kw">list</span>(<span class="dt">interval=</span><span class="kw">cbind</span>(intervalMat,intervalMat,intervalMat)),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true"></a>    <span class="dt">obsToY=</span>o2yGMM, <span class="dt">piFun=</span><span class="st">&quot;crPiFun&quot;</span>, <span class="dt">numPrimary=</span>nVisits)</span></code></pre></div>
<pre><code>## Warning: obsCovs contains characters. Converting them to factors.</code></pre>
<p>Notice that we have 3 types of covariates now. The site-specific covariates are the same as before. Now, however, the observation covariates must match the dimensions of the <span class="math inline">\({\bf y}\)</span> matrix. We can also have a class of covariates that vary among primary periods but not within primary periods. These are called <code>yearlySiteCovs</code>, which is a misleading name. It is a carry-over from other “open population” models in <code>unmarked</code>, but it should be remembered that these models are most suitable for data from a single year, since we assume no births or mortalities.</p>
<p>We can fit the model using the <code>gmultmix</code> function, which has a slightly different set of arguments. Rather than a single formula, the function takes 3 formulas for abundance covariates, availability covariates, and detection covariates in that order.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a>(fm1 &lt;-<span class="st"> </span><span class="kw">gmultmix</span>(<span class="op">~</span>woody, <span class="op">~</span><span class="dv">1</span>, <span class="op">~</span>time<span class="op">+</span>date, umf.cr, <span class="dt">engine=</span><span class="st">&quot;R&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: K was not specified and was set to 103.</code></pre>
<pre><code>## 
## Call:
## gmultmix(lambdaformula = ~woody, phiformula = ~1, pformula = ~time + 
##     date, data = umf.cr, engine = &quot;R&quot;)
## 
## Abundance:
##             Estimate    SE      z P(&gt;|z|)
## (Intercept)  -0.0896 0.393 -0.228 0.81953
## woody         2.4294 0.591  4.107 0.00004
## 
## Availability:
##  Estimate    SE     z P(&gt;|z|)
##    -0.782 0.495 -1.58   0.114
## 
## Detection:
##             Estimate     SE      z  P(&gt;|z|)
## (Intercept)   2.1050 1.1139  1.890 0.058792
## time         -0.0499 0.0142 -3.526 0.000422
## date         -0.0285 0.1369 -0.208 0.835258
## 
## AIC: 580.4508</code></pre>
<p>Results from this model are similar to those obtained using the subset of data, but the standard error for the woody estimate has decreased. If we back-transform the estimate of <span class="math inline">\(\phi\)</span>, we see that the probability of being available for detection is 0.31.</p>
<p>Another feature of <code>gmultmix</code> is that <span class="math inline">\(N\)</span> can be modeled using either the Poisson or negative binomial distribution. We might eventually add other options such as the zero-inflated Poisson.</p>
</div>
<div id="references" class="section level1 unnumbered" number>
<h1 class="unnumbered" number>References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-alldredge_etal:2007">
<p>Alldredge, M. W., K. H. Pollock, T. R. Simons, J. A. Collazo, S. A. Shriner, and D. Johnson. 2007. Time-of-detection method for estimating abundance from point-count surveys. The Auk 124:653–664.</p>
</div>
<div id="ref-chandler_etal:2009">
<p>Chandler, R. B., D. I. King, and S. DeStefano. 2009. Scrub-shrub bird habitat associations at multiple spatial scales in beaver meadows in massachusetts. The Auk:186–197.</p>
</div>
<div id="ref-chandlerEA_2011">
<p>Chandler, R. B., J. A. Royle, and D. I. King. 2011. Inference about density and temporary emigration in unmarked populations. Ecology 92:1429–1435.</p>
</div>
<div id="ref-dorazio_etal:2005">
<p>Dorazio, R. M., H. L. Jelks, and F. Jordan. 2005. Improving removal-based estimates of abundance by sampling a population of spatially distinct subpopulations. Biometrics 61:1093–1101.</p>
</div>
<div id="ref-efford:2004">
<p>Efford, M. 2004. Density estimation in live-trapping studies. Oikos 106:598–610.</p>
</div>
<div id="ref-kendall_etal:1997">
<p>Kendall, W. L., J. D. Nichols, and J. E. Hines. 1997. Estimating temporary emigration using capture-recapture data with Pollock’s robust design. Ecology 78:563–578.</p>
</div>
<div id="ref-link:2003">
<p>Link, W. A. 2003. Nonidentifiability of population size from capture-recapture data with heterogeneous detection probabilities. Biometrics 59:1123–1130.</p>
</div>
<div id="ref-otis_etal:1978">
<p>Otis, D. L., K. P. Burnham, G. C. White, and D. R. Anderson. 1978. Statistical inference from capture data on closed animal populations. Wildlife monographs:3–135.</p>
</div>
<div id="ref-royle_generalized_2004">
<p>Royle, J. A. 2004. Generalized estimators of avian abundance from count survey data. Animal Biodiversity and Conservation 27:375–386.</p>
</div>
<div id="ref-royle_dorazio:2008">
<p>Royle, J. A., and R. M. Dorazio. 2008. Hierarchical modeling and inference in ecology: The analysis of data from populations, metapopulations and communities. Academic Press.</p>
</div>
<div id="ref-royle_young:2008">
<p>Royle, J. A., and K. V. Young. 2008. A Hierarchical Model For Spatial Capture-Recapture Data. Ecology 89:2281–2289.</p>
</div>
<div id="ref-williams_etal:2002">
<p>Williams, B. K., J. D. Nichols, and M. J. Conroy. 2002. Analysis and management of animal populations: modeling, estimation, and decision making. Academic Pr.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
