<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Ken Kellner" />

<meta name="date" content="2021-09-10" />

<title>Simulating datasets</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Simulating datasets</h1>
<h4 class="author">Ken Kellner</h4>
<h4 class="date">September 10, 2021</h4>


<div id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#components-of-a-call-to-simulate"><span class="toc-section-number">2</span> Components of a call to simulate</a></li>
<li><a href="#simulating-an-occupancy-dataset"><span class="toc-section-number">3</span> Simulating an occupancy dataset</a><ul>
<li><a href="#formulas"><span class="toc-section-number">3.1</span> Formulas</a></li>
<li><a href="#regression-coefficients"><span class="toc-section-number">3.2</span> Regression coefficients</a></li>
<li><a href="#study-design-information"><span class="toc-section-number">3.3</span> Study design information</a></li>
<li><a href="#put-it-all-together"><span class="toc-section-number">3.4</span> Put it all together</a></li>
<li><a href="#customizing-the-covariates"><span class="toc-section-number">3.5</span> Customizing the covariates</a></li>
<li><a href="#models-that-require-more-information"><span class="toc-section-number">3.6</span> Models that require more information</a></li>
<li><a href="#simulating-a-more-complex-dataset-gdistremoval"><span class="toc-section-number">3.7</span> Simulating a more complex dataset: gdistremoval</a></li>
</ul></li>
<li><a href="#conclusion"><span class="toc-section-number">4</span> Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Simulating datasets is a powerful and varied tool when conducting <code>unmarked</code> analyses. Writing our own code to simulate a dataset based on a given model is an excellent learning tool, and can help us test if a given model is generating the expected results. If we simulate a series of datasets based on a fitted model, and calculate a statistic from each of those fits, we can generate a distribution of the statistic - this is what the <code>parboot</code> function does. This can be helpful, for example, when testing goodness of fit. Finally, simulation can be a useful component of power analysis when a closed-form equation for power is not available.</p>
<p><code>unmarked</code> provides two different ways of generating simulated datasets, depending on the stage we are at in the modeling process.</p>
<ol style="list-style-type: decimal">
<li>Generating simulated datasets from a fitted model we already have</li>
<li>Generating simulated datasets from scratch</li>
</ol>
<p>For (1), we simply call the <code>simulate</code> method on our fitted model object and new dataset(s) are generated. This is the approach used by <code>parboot</code>. In this vignette we will focus on (2), a more flexible approach to simulation, also using the <code>simulate</code> method, that allows us to generate a dataset corresponding to any <code>unmarked</code> model from scratch.</p>
</div>
<div id="components-of-a-call-to-simulate" class="section level1">
<h1><span class="header-section-number">2</span> Components of a call to simulate</h1>
<p>We will need to provide, at a minimum, four pieces of information to <code>simulate</code> in order to simulate a dataset from scratch in <code>unmarked</code>.</p>
<ol style="list-style-type: decimal">
<li>The name of the fitting function for the model we want to simulate from, as a character string</li>
<li>A list of formulas, one per submodel, containing the names of the covariates we want to include in each</li>
<li>A list of vectors of regression coefficients (intercepts and slopes), one per submodel, matching the formulas</li>
<li>A list of design components; for example, the number of sites and number of observations per site</li>
</ol>
<p>A number of other arguments are available, e.g. for how to customize how the covariates are randomly generated or for distributions to use when simulating abundances. We’ll show those later. The easiest way to demonstrate how to use <code>simulate</code> is to look at an example: we’ll start with a simple one for occupancy.</p>
</div>
<div id="simulating-an-occupancy-dataset" class="section level1">
<h1><span class="header-section-number">3</span> Simulating an occupancy dataset</h1>
<p>Suppose we want to simulate an occupancy dataset in which site occupancy is affected by elevation. The first piece of information needed is the name of model to use: the fitting function for occupancy is <code>occu</code>, so the first argument to <code>simulate</code> and the name of the model will be <code>&quot;occu&quot;</code>.</p>
<div id="formulas" class="section level2">
<h2><span class="header-section-number">3.1</span> Formulas</h2>
<p>Second we must define the desired model structure as a list of formulas, one per submodel. “Submodels” here are the hierarchical components of the model; for example, an occupancy model has a state (occupancy) submodel and an observation (detection) submodel. These submodels are identified by short names: <code>state</code> and <code>det</code>. We will use these short names repeatedly. In order to identify which submodels are needed and what their short names are, we can simply fit any model of that type (e.g. from the example) and call <code>names(model)</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(unmarked)</a>
<a class="sourceLine" id="cb1-3" title="3">umf &lt;-<span class="st"> </span><span class="kw">unmarkedFrameOccu</span>(<span class="dt">y=</span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">nrow=</span><span class="dv">3</span>))</a>
<a class="sourceLine" id="cb1-4" title="4">mod &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="dv">1</span><span class="op">~</span><span class="dv">1</span>, umf)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">names</span>(mod)</a></code></pre></div>
<pre><code>## [1] &quot;state&quot; &quot;det&quot;</code></pre>
<p>Formulas are supplied as a named list. The list has one element per submodel, and the names of the elements are the short names defined above. Each list element is a formula, containing the desired number of covariates to use, and the names of these covariates. Below we define our list of formulas, including an effect of elevation on occupancy (note we could name this whatever we want, here we call it <code>elev</code>). We don’t want any covariates on detection probability, so the formula defines the model as intercept only: <code>~1</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">forms &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">state=</span><span class="op">~</span>elev, <span class="dt">det=</span><span class="op">~</span><span class="dv">1</span>)</a></code></pre></div>
</div>
<div id="regression-coefficients" class="section level2">
<h2><span class="header-section-number">3.2</span> Regression coefficients</h2>
<p>Next we must tell <code>unmarked</code> what the values for the intercept and regression coefficients in each submodel should be. Once again, this is a named list, one element for each submodel. Each list element is a numeric vector. The components of each numeric vector must also be named, matching the covariate names in our list of formulas. Don’t forget we also must specify a value for the intercept in each submodel (can be named <code>Intercept</code> or <code>intercept</code>). If we are not sure exactly how to structure this list, just skip it for now: <code>unmarked</code> can generate a template for us to fill in later.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">coefs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">state=</span><span class="kw">c</span>(<span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">elev=</span><span class="op">-</span><span class="fl">0.4</span>), <span class="dt">det=</span><span class="kw">c</span>(<span class="dt">intercept=</span><span class="dv">0</span>))</a></code></pre></div>
<p>We have a list with two elements, each a numeric vector. Both contain intercept values, and the <code>state</code> vector also contains a value corresponding to the desired effect of our covariate <code>elev</code>.</p>
</div>
<div id="study-design-information" class="section level2">
<h2><span class="header-section-number">3.3</span> Study design information</h2>
<p>Finally, we need to give <code>unmarked</code> information about the study design. This is pretty simple: we just need a list containing values for <code>M</code>, the number of sites, and <code>J</code> the number of surveys per site. For models with multiple primary periods, we’d also need a value of <code>T</code>, the number of primary periods.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">design &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">M=</span><span class="dv">300</span>, <span class="dt">J=</span><span class="dv">8</span>) <span class="co"># 300 sites, 8 occasions per site</span></a></code></pre></div>
</div>
<div id="put-it-all-together" class="section level2">
<h2><span class="header-section-number">3.4</span> Put it all together</h2>
<p>We’re now ready to simulate a dataset. To do this we use the <code>simulate</code> function, providing as arguments the name of the model <code>&quot;occu&quot;</code> and the three lists we constructed above. Actually, first, let’s not supply the <code>coefs</code> list, to show how <code>unmarked</code> will generate a template for us to use:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">simulate</span>(<span class="st">&quot;occu&quot;</span>, <span class="dt">formulas=</span>forms, <span class="dt">design=</span>design)</a></code></pre></div>
<pre><code>## coefs argument should be a named list of named vectors, with the following structure
##         (replacing 0s with your desired coefficient values):
## 
## $state
## intercept      elev 
##         0         0 
## 
## $det
## intercept 
##         0 
## 
## Error : Supply coefs argument as specified above</code></pre>
<p>We can replicate this provided list structure and fill in our own numeric values. Once we have our coefficients set up properly, add them to the function call:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">occu_umf &lt;-<span class="st"> </span><span class="kw">simulate</span>(<span class="st">&quot;occu&quot;</span>, <span class="dt">formulas=</span>forms, <span class="dt">coefs=</span>coefs, <span class="dt">design=</span>design)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">head</span>(occu_umf)</a></code></pre></div>
<pre><code>## Data frame representation of unmarkedFrame object.
##    y.1 y.2 y.3 y.4 y.5 y.6 y.7 y.8       elev
## 1    0   0   0   0   0   0   0   0 -0.7152422
## 2    0   0   0   0   0   0   0   0 -0.7526890
## 3    0   0   0   0   1   0   1   0 -0.9385387
## 4    0   0   0   0   0   0   0   0 -1.0525133
## 5    1   0   0   0   0   0   1   0 -0.4371595
## 6    0   1   0   1   1   0   0   0  0.3311792
## 7    1   1   1   0   0   0   0   0 -2.0142105
## 8    0   0   0   0   0   0   0   0  0.2119804
## 9    1   0   0   1   0   1   0   0  1.2366750
## 10   0   0   0   0   0   0   0   0  2.0375740</code></pre>
<p><code>unmarked</code> has generated a presence-absence dataset as well as values for covariate <code>elev</code>. We can check that it worked as expected by fitting the corresponding model to the dataset, and making sure the estimated values are similar:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">(<span class="kw">occu</span>(<span class="op">~</span><span class="dv">1</span> <span class="op">~</span>elev, occu_umf))</a></code></pre></div>
<pre><code>## 
## Call:
## occu(formula = ~1 ~ elev, data = occu_umf)
## 
## Occupancy:
##             Estimate    SE      z  P(&gt;|z|)
## (Intercept)  -0.0845 0.119 -0.712 0.476492
## elev         -0.4407 0.125 -3.514 0.000442
## 
## Detection:
##  Estimate   SE       z P(&gt;|z|)
##  -0.00451 0.06 -0.0751    0.94
## 
## AIC: 1992.853</code></pre>
</div>
<div id="customizing-the-covariates" class="section level2">
<h2><span class="header-section-number">3.5</span> Customizing the covariates</h2>
<p>By default, a covariate will be continuous and come from a standard normal distribution (mean 0, SD 1). However, we can control this using the <code>guide</code> argument. For example, suppose we want elevation to come from a random normal, but with a mean of 2 and a standard deviation of 0.5. We can provide a named list to the <code>guide</code> argument as follows:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">guide &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">elev=</span><span class="kw">list</span>(<span class="dt">dist=</span>rnorm, <span class="dt">mean=</span><span class="dv">2</span>, <span class="dt">sd=</span><span class="fl">0.5</span>))</a></code></pre></div>
<p><code>guide</code> contains one element, called <code>elev</code>, which is also a list and contains three components:</p>
<ol style="list-style-type: decimal">
<li>The random distribution function to use, <code>rnorm</code></li>
<li>The mean of the distribution</li>
<li>The SD of the distribution</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">occu_umf &lt;-<span class="st"> </span><span class="kw">simulate</span>(<span class="st">&quot;occu&quot;</span>, <span class="dt">formulas=</span>forms, <span class="dt">coefs=</span>coefs, <span class="dt">design=</span>design, <span class="dt">guide=</span>guide)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">head</span>(occu_umf)</a></code></pre></div>
<pre><code>## Data frame representation of unmarkedFrame object.
##    y.1 y.2 y.3 y.4 y.5 y.6 y.7 y.8     elev
## 1    0   0   0   0   0   0   0   0 2.063074
## 2    0   0   0   0   0   0   0   0 2.236400
## 3    0   0   0   0   0   0   0   0 1.829623
## 4    0   0   0   0   0   0   0   0 1.879105
## 5    0   0   0   0   0   0   0   0 2.689377
## 6    0   0   0   0   0   0   0   0 1.830558
## 7    0   0   0   0   0   0   0   0 2.010068
## 8    0   0   0   0   0   0   0   0 2.188481
## 9    1   1   1   0   0   0   1   1 1.784138
## 10   0   0   0   0   0   0   0   0 2.979532</code></pre>
<p>You can see the <code>elev</code> covariate now has values corresponding to the desired distribution. Note that the elements of the list will depend on the arguments required by the random distribution function. For example, to use a uniform distribution instead:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">guide &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">elev=</span><span class="kw">list</span>(<span class="dt">dist=</span>runif, <span class="dt">min=</span><span class="dv">0</span>, <span class="dt">max=</span><span class="dv">1</span>)) </a>
<a class="sourceLine" id="cb15-2" title="2">occu_umf &lt;-<span class="st"> </span><span class="kw">simulate</span>(<span class="st">&quot;occu&quot;</span>, <span class="dt">formulas=</span>forms, <span class="dt">coefs=</span>coefs, <span class="dt">design=</span>design, <span class="dt">guide=</span>guide)</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">head</span>(occu_umf)</a></code></pre></div>
<pre><code>## Data frame representation of unmarkedFrame object.
##    y.1 y.2 y.3 y.4 y.5 y.6 y.7 y.8      elev
## 1    0   0   0   0   0   0   0   0 0.4154205
## 2    0   0   1   1   0   1   1   0 0.1033568
## 3    1   1   1   0   0   0   1   1 0.8845174
## 4    1   0   0   1   0   0   1   0 0.9871606
## 5    0   0   0   1   0   0   1   1 0.5916545
## 6    0   1   0   0   1   1   1   1 0.9046272
## 7    0   0   0   0   0   0   0   0 0.3075379
## 8    0   0   0   0   0   0   0   0 0.6759720
## 9    0   0   0   0   0   0   0   0 0.7358022
## 10   0   0   0   0   0   0   0   0 0.4075122</code></pre>
<p>It is also possible to define a categorical (factor) covariate. We specify an entry in the <code>guide</code> list, but instead of a list, we supply a call to <code>factor</code> which defines the desired factor levels. For example, suppose we want to add a new <code>landcover</code> covariate to our simulated model. First, define the new formulas:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">forms2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">state=</span><span class="op">~</span>elev<span class="op">+</span>landcover, <span class="dt">det=</span><span class="op">~</span><span class="dv">1</span>)</a></code></pre></div>
<p>And then the new guide, including the information about factor levels:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">guide &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">landcover=</span><span class="kw">factor</span>(<span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;forest&quot;</span>,<span class="st">&quot;grass&quot;</span>,<span class="st">&quot;urban&quot;</span>)))</a></code></pre></div>
<p>We’d also need an updated <code>coefs</code> since we have a new covariate. Defining the <code>coefs</code> when you have factors in your model is a little trickier, since R names the effects as a combination of the factor name and the level name. There is no coefficient for the reference level (<code>&quot;forest&quot;</code> in our example), but we need to provide coefficients for both <code>&quot;grass&quot;</code> and <code>&quot;urban&quot;</code>. When combined with the factor name the complete coefficient names for these two will be <code>landcovergrass</code> and <code>landcoverurban</code>. The easiest way to make sure we get these names right is to let <code>unmarked</code> generate a template <code>coefs</code> for you as shown above, and then fill it in.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># forest is the reference level for landcover since it was listed first</span></a>
<a class="sourceLine" id="cb19-2" title="2">coefs2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">state=</span><span class="kw">c</span>(<span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">elev=</span><span class="op">-</span><span class="fl">0.4</span>, <span class="dt">landcovergrass=</span><span class="fl">0.2</span>, </a>
<a class="sourceLine" id="cb19-3" title="3">                       <span class="dt">landcoverurban=</span><span class="op">-</span><span class="fl">0.7</span>), <span class="dt">det=</span><span class="kw">c</span>(<span class="dt">intercept=</span><span class="dv">0</span>))</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">head</span>(<span class="kw">simulate</span>(<span class="st">&quot;occu&quot;</span>, <span class="dt">formulas=</span>forms2, <span class="dt">coefs=</span>coefs2, <span class="dt">design=</span>design, <span class="dt">guide=</span>guide))</a></code></pre></div>
<pre><code>## Data frame representation of unmarkedFrame object.
##    y.1 y.2 y.3 y.4 y.5 y.6 y.7 y.8         elev landcover
## 1    0   1   1   1   0   1   0   1  0.253522341     grass
## 2    1   1   0   0   0   0   1   0  0.243522140    forest
## 3    0   1   0   0   1   0   1   0  0.719590250     grass
## 4    0   1   1   1   1   0   0   1  0.772732980     grass
## 5    0   0   0   0   0   0   0   0 -0.008522864    forest
## 6    1   1   0   1   1   1   1   0 -0.389069155     urban
## 7    0   0   0   0   0   0   0   0  1.328233354     urban
## 8    0   0   1   1   1   1   0   1  0.053012552    forest
## 9    1   0   0   1   0   1   1   1 -0.376265158     grass
## 10   1   1   1   0   1   0   0   1 -0.946238347     grass</code></pre>
<p>Our output dataset now includes a new categorical covariate.</p>
</div>
<div id="models-that-require-more-information" class="section level2">
<h2><span class="header-section-number">3.6</span> Models that require more information</h2>
<p>More complex models might require more information for simulation. Nearly any argument provided to either the fitting function for the model, or the corresponding <code>unmarkedFrame</code> constructor, can be provided as an optional argument to <code>simulate</code> to customize the simulation. For example, we may want to specify that abundance should be simulated as a negative binomial, instead of a Poisson, for <code>pcount</code>. This information is simply added as additional arguments to <code>simulate</code>. For example, we can simulate a <code>pcount</code> dataset using the negative binomial (<code>&quot;NB&quot;</code>) distribution. The negative binomial has an additional parameter to estimate (<code>alpha</code>) so we must also add an element to <code>coefs</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">coefs<span class="op">$</span>alpha &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">alpha=</span><span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb22-2" title="2"><span class="kw">head</span>(<span class="kw">simulate</span>(<span class="st">&quot;pcount&quot;</span>, <span class="dt">formulas=</span>forms, <span class="dt">coefs=</span>coefs, <span class="dt">design=</span>design, <span class="dt">mixture=</span><span class="st">&quot;NB&quot;</span>))</a></code></pre></div>
<pre><code>## Data frame representation of unmarkedFrame object.
##    y.1 y.2 y.3 y.4 y.5 y.6 y.7 y.8        elev
## 1    0   0   0   0   0   0   0   0 -0.37071853
## 2    1   2   2   2   0   0   2   1  0.15751357
## 3    0   0   0   0   0   0   0   0 -0.98832179
## 4    1   0   1   0   0   1   0   0  0.30113025
## 5    0   0   0   0   0   0   0   0 -1.47189644
## 6    0   0   0   0   0   0   0   0  0.02303002
## 7    2   3   1   2   3   3   3   2  1.30191316
## 8    0   0   0   0   0   0   0   0 -0.91494417
## 9    0   0   0   0   0   0   0   0  0.21043315
## 10   1   1   1   1   2   1   0   1 -2.00025076</code></pre>
<p>In the next section we will show a more detailed example involving these additional arguments.</p>
</div>
<div id="simulating-a-more-complex-dataset-gdistremoval" class="section level2">
<h2><span class="header-section-number">3.7</span> Simulating a more complex dataset: gdistremoval</h2>
<p>The <code>gdistremoval</code> function fits the model of <span class="citation">Amundson et al. (2014)</span>, which estimates abundance using a combination of distance sampling and removal sampling data. When simulating a dataset based on this model, we have to provide several additional pieces of information related to the structure of the distance and removal sampling analyses.</p>
<p>To begin, we will define the list of formulas. A <code>gdistremoval</code> model, when there is only one primary period, has three submodels: abundance (<code>&quot;lambda&quot;</code>), distance sampling (<code>&quot;dist&quot;</code>), and removal sampling (<code>&quot;rem&quot;</code>). We will fit a model with an effect of elevation <code>elev</code> on abundance and an effect of wind <code>wind</code> on removal probability.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">forms &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">lambda=</span><span class="op">~</span>elev, <span class="dt">dist=</span><span class="op">~</span><span class="dv">1</span>, <span class="dt">rem=</span><span class="op">~</span>wind)</a></code></pre></div>
<p>Next we will define the corresponding coefficients. We will set mean abundance at 5. The intercept is on the log scale, thus the intercept for <code>lambda</code> will be <code>log(5)</code>. The scale parameter for the detection function will be 50, and again it is on the log scale. The intercept for the removal probability is on the logit scale, so we will set the intercept at -1 (equivalent to a mean removal probability of about 0.27). Don’t forget the covariate effects on <code>lambda</code> and removal.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">coefs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">lambda=</span><span class="kw">c</span>(<span class="dt">intercept=</span><span class="kw">log</span>(<span class="dv">5</span>), <span class="dt">elev=</span><span class="fl">0.7</span>), </a>
<a class="sourceLine" id="cb25-2" title="2">              <span class="dt">dist=</span><span class="kw">c</span>(<span class="dt">intercept=</span><span class="kw">log</span>(<span class="dv">50</span>)), <span class="dt">rem=</span><span class="kw">c</span>(<span class="dt">intercept=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">wind=</span><span class="op">-</span><span class="fl">0.3</span>))</a></code></pre></div>
<p>Our study will have 300 sites. This model is unique in that we have to specify the number of two different types of observations: (1) the number of distance sampling bins (<code>Jdist</code>), and the number of removal intervals (<code>Jrem</code>).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">design &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">M =</span> <span class="dv">300</span>, <span class="dt">Jdist=</span><span class="dv">4</span>, <span class="dt">Jrem=</span><span class="dv">5</span>)</a></code></pre></div>
<p>Finally we are ready to simulate the dataset. In addition to the name of the model, <code>forms</code>, <code>coefs</code> and <code>design</code>, we also need to provide some additional information. We need to define the distance breaks for the distance sampling part of the model (there should be <code>Jdist+1</code> of these), and also the key function to use when simulating the detection process.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">umf &lt;-<span class="st"> </span><span class="kw">simulate</span>(<span class="st">&quot;gdistremoval&quot;</span>, <span class="dt">formulas=</span>forms, <span class="dt">coefs=</span>coefs, <span class="dt">design=</span>design,</a>
<a class="sourceLine" id="cb27-2" title="2">                <span class="dt">dist.breaks=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">100</span>), <span class="dt">keyfun=</span><span class="st">&quot;halfnorm&quot;</span>, <span class="dt">unitsIn=</span><span class="st">&quot;m&quot;</span>)</a>
<a class="sourceLine" id="cb27-3" title="3"><span class="kw">head</span>(umf)</a></code></pre></div>
<pre><code>## Data frame representation of unmarkedFrame object.
##    yDist.1 yDist.2 yDist.3 yDist.4 yRem.1 yRem.2 yRem.3 yRem.4 yRem.5
## 1        4       2      10       2      4      7      6      1      0
## 2        0       0       0       0      0      0      0      0      0
## 3        0       1       2       0      0      1      1      0      1
## 4        4       1       8       1      4      1      4      3      2
## 5        0       1       5       2      3      3      0      2      0
## 6        0       1       2       4      3      1      1      2      0
## 7        2       3       3       2      2      3      2      3      0
## 8        1       1       0       0      1      0      1      0      0
## 9        0       0       1       2      2      1      0      0      0
## 10       0       2       2       1      2      0      2      1      0
##           elev     wind.1       wind.2     wind.3     wind.4      wind.5
## 1   1.61334622  1.3649476 -1.127500269 -0.1558707 -2.1302728  0.04600723
## 2  -0.80567600  0.3281250  0.598608134  0.7481760 -0.4382321 -1.43481532
## 3  -1.14049439  1.5145357  0.310432089 -0.3901116 -0.7034511  0.68665606
## 4   1.46155447 -0.1052677  0.855721989 -0.8086349 -0.8053908  0.02402033
## 5   0.72496346  0.8454980 -1.340275756 -0.3633820  0.2957100 -0.55941853
## 6   0.78390528 -0.1319023 -0.007654917 -0.7639284  0.2234584  1.29132573
## 7   1.08265721  0.9492643  0.980460084 -0.9523599 -1.2450675  0.41913508
## 8  -0.41839316  1.1423154  0.961612070  0.4852678  1.2666489  0.57672752
## 9  -1.02443597 -1.7832070 -1.339807559  0.6682450 -0.3279624 -1.31624876
## 10  0.01774842  0.8019722  1.877960654  0.5301769 -1.7808959  0.36150801</code></pre>
<p>The result is a dataset containing a combination of distance, removal, and covariate data. We can check to see if fitting a model to this dataset recovers our specified coefficient values:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">(fit &lt;-<span class="st"> </span><span class="kw">gdistremoval</span>(<span class="dt">lambdaformula=</span><span class="op">~</span>elev, <span class="dt">removalformula=</span><span class="op">~</span>wind, </a>
<a class="sourceLine" id="cb29-2" title="2">                    <span class="dt">distanceformula=</span><span class="op">~</span><span class="dv">1</span>, <span class="dt">data=</span>umf))</a></code></pre></div>
<pre><code>## 
## Call:
## gdistremoval(lambdaformula = ~elev, removalformula = ~wind, distanceformula = ~1, 
##     data = umf)
## 
## Abundance:
##             Estimate     SE    z   P(&gt;|z|)
## (Intercept)     2.67 0.0410 65.2  0.00e+00
## elev            0.67 0.0203 33.0 1.21e-238
## 
## Distance:
##  Estimate     SE   z P(&gt;|z|)
##         4 0.0223 179       0
## 
## Removal:
##             Estimate     SE      z  P(&gt;|z|)
## (Intercept)   -0.962 0.0520 -18.50 1.90e-76
## wind          -0.262 0.0272  -9.63 5.86e-22
## 
## AIC: 6209.99</code></pre>
<p>Looks good.</p>
</div>
</div>
<div id="conclusion" class="section level1">
<h1><span class="header-section-number">4</span> Conclusion</h1>
<p>The <code>simulate</code> function provides a flexible tool for simulating data from any model in <code>unmarked</code>. These datasets can be used for a variety of purposes, such as for teaching examples, testing models, or developing new tools that work with <code>unmarked</code>. Additionally, simulating datasets is a key component of the power analysis workflow in <code>unmarked</code> - see the power analysis vignette for more examples.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-Amundson_2014">
<p>Amundson, C. L., J. A. Royle, and C. M. Handel. 2014. A hierarchical model combining distance sampling and time removal to estimate detection probability during avian point counts. The Auk 131:476–494.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
